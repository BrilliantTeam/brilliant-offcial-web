---

title: 贊助資訊

layout: 贊助資訊

excerpt: 理性消費，三思而後行！

date: 2023-05-18 00:00

sticky: 96

comments: false

index_img: img/贊助資訊/贊助資訊A.png

banner_img: img/贊助資訊/贊助資訊A.png

---

<style>
details {
  border: 1px solid #424242;
  border-radius: 4px;
  padding: 0.5em 0.5em 0;
}

summary {
  font-weight: bold;
  margin: -0.5em -0.5em 0;
  padding: 0.5em;
}

details[open] {
  padding: 0.5em;
}

details[open] summary {
  border-bottom: 1px solid #424242;
  margin-bottom: 0.5em;
}

</style>

![](img/贊助資訊/橫幅.png)

> 開設伺服器都需要資金來維持伺服器的運營，
> 或者購買更好的配備來提升遊戲體驗，
> 因此經管理層決議後我們開設了伺服贊助機制，
> 透過贊助的方式，來最直接的支持伺服器。 

# 資金使用 

輝煌伺服器方透過玩家贊助獲得的資金，
將作為持續運營伺服器、購買更好的配備等與伺服器有關的使用，
亦或者支持伺服器團隊人員現實所需，
絕不用作其它任何各方面之用途。

# 贊助回饋

輝煌伺服器為非營利相關事業或公司，
需了解贊助即同意伺服器方的持續運營及購買更好的配備之行為，
而非贊助者方與伺服器方之買賣行為，
且伺服器方不會以強制、或任何威脅性質的行為要求玩家贊助本伺服器。

<iframe src="https://docs.google.com/spreadsheets/d/e/2PACX-1vS9XOq8OZCQHy80osk_HnuV5oWZoFSsjc2-BovYh4Zw514tg76wRD7yhpLlTRMpd3cOQ_uLQrsqllkw/pubhtml?gid=0&amp;single=true&amp;widget=true&amp;headers=false" width="100%" height="700"></iframe>

# 贊助須知 
1. 在下方表格填寫 <span class="label label-warning">要求資訊</span> 後結帳，
煩請務必填寫 <span class="label label-info">Minecraft ID</span> ，倘若 <span class="label label-info">ID</span> 為 <span class="label label-danger">空</span> 或 <span class="label label-danger">不存在</span> ，將視為無償贊助。

2. 本服的贊助為 <span class="label label-warning">累積制</span> ，
倘若您第一次贊助 <span class="label label-info">200 元</span> 、第二次贊助 <span class="label label-success">270 元</span> ，您將可以獲得 <span class="label label-danger">470 元</span> 的回饋。

3. 伺服器方不會以 <span class="label label-danger">強制</span> 、或 <span class="label label-danger">任何威脅性質</span> 的行為要求玩家贊助本伺服器，
在贊助完畢後，系統將 <span class="label label-success">自動給予</span> 回饋，不需要人工核對。

4. 目前我們提供：
 <span class="label label-info">7-11 超商代碼</span> 、 <span class="label label-info">FamilyMart 超商代碼</span> 、 <span class="label label-info">銀行 WebATM 轉帳</span> 、 <span class="label label-warning">四大超商條碼（不推薦）</span> 、 <span class="label label-warning">[PayPal](https://www.brilliantw.net/%E8%B4%8A%E5%8A%A9%E8%B3%87%E8%A8%8A/#%E6%82%A8%E6%98%AF%E6%B5%B7%E5%A4%96%EF%BC%88%E9%9D%9E%E8%87%BA%E7%81%A3%EF%BC%89%E7%9A%84%E7%8E%A9%E5%AE%B6%E5%97%8E%EF%BC%9F)（海外玩家）</span>的方式。

5. 倘若還有更多疑問請在 [Discord 群組 💼・問題求助](https://discord.brilliantw.net/) 中詢問。

# 支持我們繼續運營下去
<form name="donation" onsubmit="return false;">

![](img/贊助資訊/贊助資訊B.png)
{% note warning %}
在贊助前，請確保您以詳閱我們的 [贊助資訊](https://www.brilliantw.net/贊助資訊) 與 [服務條款](https://www.brilliantw.net/服務條款)
{% endnote %}

<div class="row justify-content-start">

- 您的 <span class="label label-info">遊戲 ID</span>（大小寫需正確）  
<div class="col-6">
<input class="form-control bg-dark" id="minecraftName" name="name" type="text" placeholder="範例：RiceChen_" onfocusout="checkMinecraftNameWithProxy()" required>
  <div id="preserve-minecraft-name"></div>
</div>


- 您的 <span class="label label-success">Discord 使用者名稱</span>
- （大小寫需正確，例如：<span class="label label-success">ricechen_</span>）   
<div class="col-6">
<input class="form-control bg-dark" id="discordTag" name="discordTag" type="text" placeholder="範例：ricechen_" onfocusout="checkDiscordTagWithProxy()" required>
  <div id="preserve-discord-tag"></div>
</div>

- 已累積贊助金額（新台幣，不影響最終支付金額，可留空）   
<div class="col-6 calculator-container">
<input class="form-control bg-dark" id="cumulative-amount" name="cumulativeAmount" type="text" placeholder="輸入已累積贊助金額或留空" oninput="calculateWatercress()">
  <div id="cumulative-amount-output"></div>
</div>

- 贊助金額（新台幣）   
<div class="col-6 calculator-container">
<input class="form-control bg-dark" id="donate-amount" name="donateAmount" type="text" placeholder="一次最低 30 元 最高 10000 元" oninput="calculateWatercress()" onfocusout="checkAmount()" min="30" max="10000" required>
  <div id="preserve-amount"></div>
  <div id="Watercress-output"></div>
</div>


- 贊助留言（可留空，最多 100 個字元）   
<div class="col-6">
<input class="form-control bg-dark" id="comment" name="comment" type="text" placeholder="範例：我愛輝煌" input type="text" maxlength="100">
</div>


- 選擇贊助感謝公告的發佈方式（伺服器內）   
<div class="col-6">
<select class="form-control bg-dark" name="publishWayMinecraft" aria-label="publish-way">
  <option value="0" selected>發布於伺服器內聊天頻道</option>
  <option value="3">不發佈</option>
</select>
  </div>

- 選擇贊助感謝公告的發佈方式（Discord 群組）   
<div class="col-6">
<select class="form-control bg-dark" name="publishWayDiscord" aria-label="publish-way-discord">
  <option value="0" selected>公開發布於 🍪・贊助感謝 與 💬・伺服對話 頻道</option>
  <option value="1">以【匿名身份】發布於 🍪・贊助感謝 頻道</option>
</select>
  </div>


- 付款方式   
<div class="col-6">
<select class="form-control bg-dark" name="paymentMethod" aria-label="payment-method">
  <option value="4" selected>7-11 超商代碼繳費</option>
  <option value="6">全家 超商代碼繳費</option>
  <option value="2">【暫時停用】銀行 WebATM 轉帳</option>
  <option value="3">【不推薦】四大超商條碼繳費）</option>
</select>
</div>
</div>

<br />

<input type="checkbox" id="check-tos">
<label for="check-tos" class="form-check-label">最後付款前，請確定您已查閱好本服相關的<a href="https://www.brilliantw.net/服務條款">服務條款</a></label>
<div id="preserve-checkbox-status" style="color: red;"></div>

<br />
<button class="btn btn-primary" id="submit">已確認填寫資訊無誤，前往付款。</button>

</form>

## 您是海外（非臺灣）的玩家嗎？
您可以透過此 [PayPal 連結](https://www.paypal.me/mcbrilliant) 進行贊助，
在要求填寫用途的欄位，請依照以下格式填寫：

{% note warning %}
MCID : <span class="label label-success">填你的 Minecraft ID</span>
DCID : <span class="label label-info">填你的 Discord ID</span>
贊助輝煌伺服器新臺幣 <span class="label label-warning">多少</span> 元
{% endnote %}

倘若未依格式填寫、查找不到該 <span class="label label-success">MC</span>／<span class="label label-info">DC</span> 的 <span class="label label-danger">ID</span> ，
將視為無償贊助，不會給予贊助回饋（因為查不到這人）

有關於貨幣匯率部分，依照 [此匯率轉換器](https://wise.com/zh-hk/compare/paypal-usd-to-twd) 所提供的選項，
選擇 <span class="label label-info">您國家的貨幣</span>，然後轉換成 <span class="label label-success">TWD 新臺幣</span>，
然後將 <span class="label label-warning">您要贊助的金額 × <span class="label label-success">轉換出來的數值</span></span>，
即可對應到 [官網贊助回饋](https://www.brilliantw.net/贊助資訊#贊助回饋) 中，描述的 <span class="label label-info">所需新台幣</span> 部分。

在我們收到款項後，將「手動」進行贊助回饋的處理，
故非即時，但一定會給回饋，這點還請須知。

# 累積贊助 1170 新台幣以上回饋 - 全地圖飛行
透過花費 <a href="https://www.brilliantw.net/%E8%B4%8A%E5%8A%A9%E8%B3%87%E8%A8%8A/#%E8%B4%8A%E5%8A%A9%E7%A6%8F%E5%88%A9">水芥</a> ，
玩家可以以 <font color="#e6bbf6">1</font> <a href="https://www.brilliantw.net/%E8%B4%8A%E5%8A%A9%E8%B3%87%E8%A8%8A/#%E8%B4%8A%E5%8A%A9%E7%A6%8F%E5%88%A9">水芥</a> = <font color="#a4ff88">5</font> 秒<font color="#ff7a7a">【當前分流飛行點數】</font> 的匯率來購買 <a href="https://www.brilliantw.net/贊助資訊/#全地圖飛行">全地圖飛行的時間</a> ，
使用 <a href="https://www.brilliantw.net/%E8%B4%8A%E5%8A%A9%E8%B3%87%E8%A8%8A/#%E8%B4%8A%E5%8A%A9%E7%A6%8F%E5%88%A9">水芥</a> 購買的 <font color="#ff7a7a">【當前分流飛行點數】</font>，無論贊助階級，都可超出 <font color="#ffbb06">【飛行點數上限】</font> 。

而透過 <a href="https://www.brilliantw.net/贊助資訊/#贊助輝煌伺服器">贊助伺服器</a> 的方式，
玩家可以一次取得大量的 <font color="#a4ff88">【跨分流飛行點數】</font> ！
並且累積贊助達 <font color="#ffbb06">1170</font> 新台幣後，<font color="#ffbb06">【飛行點數】</font> 將會隨著時間恢復。

有關以上特殊名詞與全飛行地圖詳細機制，請詳見下方名詞說明。

## 相關指令

<table>
  <tr>
    <th>指令</th>
    <th>功能</th>
  </tr>
  <tr>
    <td>/donatefly buy <font color="#ffbb06">【飛行點數】</font></td>
    <td>使用 <a href="https://www.brilliantw.net/%E8%B4%8A%E5%8A%A9%E8%B3%87%E8%A8%8A/#%E8%B4%8A%E5%8A%A9%E7%A6%8F%E5%88%A9">水芥</a> 購買 <font color="#ff7a7a">【當前分流飛行點數】</font></td>
  </tr>
  <tr>
    <td>/donatefly info</td>
    <td>查看查看個人全地圖飛行相關資訊。</td>
  </tr>
  <tr>
    <td>/donatefly resleft</td>
    <td>調整當從領地內離開時，是否消耗<font color="#ffbb06">【全地圖飛行點數】</font>於領地外繼續飛行。</td>
  </tr>
  <tr>
    <td>/donatefly toggle</td>
    <td>調整是否消耗<font color="#ffbb06">【全地圖飛行點數】</font>進行飛行功能。</td>
  </tr>
</table>

![donatefly info](img/贊助資訊/donatefly.png)

## 贊助數值

<table>
  <tr>
    <th>贊助額度</th>
    <th>首次達到該額度可獲<font color="#a4ff88">【跨分流飛行點數】</font>量</th>
    <th>在線上時，恢復的<font color="#ff7a7a">【當前分流飛行點數】</font>量</th>
    <th>後續每贊助<font color="#ffbb06">1</font>新台幣後，恢復的<font color="#a4ff88">【跨分流飛行點數】</font>量</th>
    <th>飛行點數上限</th>
  </tr>
  <tr>
    <td>0 元</td>
    <td>0 點</td>
    <td>每 0 秒恢復 0 點</td>
    <td>0 點</td>
    <td>0 點</td>
  </tr>
  <tr>
    <td>1170 元</td>
    <td>3600 點</td>
    <td>每 600 秒恢復 20 點</td>
    <td>20 點</td>
    <td>1200 點</td>
  </tr>
  <tr>
    <td>1970 元</td>
    <td>7200 點</td>
    <td>每 600 秒恢復 60 點</td>
    <td>60 點</td>
    <td>3600 點</td>
  </tr>
  <tr>
    <td>2470 元</td>
    <td>8400 點</td>
    <td>每 600 秒恢復 80 點</td>
    <td>80 點</td>
    <td>4800 點</td>
  </tr>
  <tr>
    <td>2970 元</td>
    <td>9600 點</td>
    <td>每 600 秒恢復 100 點</td>
    <td>100 點</td>
    <td>6000 點</td>
  </tr>
  <tr>
    <td>3470 元</td>
    <td>10800 點</td>
    <td>每 600 秒恢復 120 點</td>
    <td>120 點</td>
    <td>7200 點</td>
  </tr>
  <tr>
    <td>3970 元</td>
    <td>12000 點</td>
    <td>每 600 秒恢復 140 點</td>
    <td>140 點</td>
    <td>8400 點</td>
  </tr>
</table>

## 飛行點數是什麼？
<font color="#ffbb06">【飛行點數】</font>分為<font color="#ff7a7a">【當前分流飛行點數】</font>與<font color="#a4ff88">【跨分流飛行點數】</font>兩種，
這兩種飛行點數都將顯示為一個<font color="#ffbb06">【飛行點數】</font>數值，
以下為<font color="#ffbb06">【飛行點數】</font>說明：

### 【當前分流飛行點數】
當你在某一分流上線/飛行時
將恢復/扣除的點數值，例如你的飛行點數有 <font color="#a4ff88">50 秒</font>，
你在第一分流飛行 <font color="#ffbb06">10 秒</font>後，第一分流的飛行點數將剩下 <font color="#ff7a7a">40 秒</font>，
但是第二分流的點數依然是 <font color="#a4ff88">50 秒</font>。

### 【跨分流飛行點數】
以<font color="#a4ff88">贊助方式</font>，獲取的點數值，
例如你的飛行點數有 <font color="#ff7a7a">50 秒</font>，
你贊助了一定金額後，獲取了 <font color="#ffbb06">10 秒</font>的點數，
那麼在第一、第二分流中，其<font color="#ff7a7a">【當前分流飛行點數】</font>都會是 <font color="#a4ff88">60 秒</font>。

### 情境舉例

<table>
  <tr>
    <th>贊助額度</th>
    <th>在領地<font color="#a4ff88">內</font>飛行，是否消耗<font color="#ff7a7a">【當前分流飛行點數】</font></th>
    <th>在領地<font color="#ff7a7a">外</font>飛行，是否消耗<font color="#ff7a7a">【當前分流飛行點數】</font></th>
  </tr>
  <tr>
    <td>未達 <font color="#ffbb06">470</font> 新台幣</td>
    <td>✅</td>
    <td>✅</td>
  </tr>
  <tr>
    <td>達到 <font color="#ffbb06">470</font> 新台幣</td>
    <td>❌</td>
    <td>✅</td>
  </tr>
  <tr>
    <td>達到 <font color="#ffbb06">1170</font> 新台幣</td>
    <td>❌</td>
    <td>✅</td>
  </tr>
</table>

## 飛行點數恢復方式

1. 持續在線上 <font color="#ffbb06">600 秒</font>，將根据階級，來恢復<font color="#ff7a7a">【當前分流飛行點數】</font>。
2. 每贊助 <font color="#ffbb06">1 新台幣</font>，將根据階級，來恢復<font color="#a4ff88">【跨分流飛行點數】</font>。
   並且以贊助方式獲取的<font color="#a4ff88">【跨分流飛行點數】</font>，可超出<font color="#ff7a7a">【飛行點數上限】</font>。

## 飛行點數上限是什麼？
當恢復的<font color="#ffbb06">【飛行點數】</font>達到<font color="#ff7a7a">【飛行點數上限】</font>時，
將不再以<font color="#a4ff88">玩家在線上</font>的方式來恢復<font color="#ffbb06">【飛行點數】</font>，
除非<font color="#ffbb06">【飛行點數】</font>被消耗至未達上限，玩家在線時才會自動恢復。
而根據階級的不同，<font color="#ffbb06">飛行點數</font>的恢復上限也會有所不同。

# 累積贊助 2970 新台幣以上回饋 - 自定義顯示暱稱
當你更改顯示暱稱後，將會在各個地方使用這個顯示暱稱。

<table>
  <tr>
    <th>指令</th>
    <th>功能</th>
  </tr>
  <tr>
    <td>/nickname set <暱稱></td>
    <td>更改顯示暱稱，上限 20 個字。</td>
  </tr>
  <tr>
    <td>/nickname remove</td>
    <td>移除顯示暱稱。</td>
  </tr>
</table>

顯示暱稱的『色碼』不會計入字符數，
這意味著，可以做出具有漸層或者 RGB 的顯示暱稱。

<table>
  <tr>
    <td>&6你好</td>
    <td>兩個字</td>
  </tr>
  <tr>
    <td>& #555555你好</td>
    <td>兩個字</td>
  </tr>
  <tr>
    <td>#555555你好</td>
    <td>兩個字</td>
  </tr>
</table>

# 累積贊助 3470 新台幣以上回饋 - 建立自定義專屬個人稱號
為感謝玩家們的贊助支持，倘若當您的累積贊助額度達到 <font color="#ffbb06">3470</font> 新台幣，
玩家可至 [Discord 群組 💼・問題求助](https://discord.brilliantw.net/) 申請 1 個 <font color="#a4ff88">【自定義專屬個人稱號】</font>，

<details>
  <summary>以下為 <font color="#a4ff88">自定義專屬個人稱號</font> 申請辦法</summary>

1. 稱號字數最多 <font color="#ff7a7a">4 個字</font> + 最多 <font color="#ff7a7a">1 本群靜態表符</font> 。
2. 稱號中只能使用 <font color="#ff7a7a">一種</font> 顏色代碼，可使用 <font color="#ffbb06">十六進制色碼</font> 。
3. 稱號名 <font color="#ff7a7a">不可</font> 與官方、活動、乙太、水芥 稱號相似，避免誤會。
4. 稱號名稱不可違反 <font color="#ff7a7a">服規二</font> 所規範內容。
5. 稱號建立後，<font color="#ff7a7a">不得修改</font> 。
6. 稱號為 <font color="#ffbb06">跨分流給予</font> 。（全分流）
</details>

![](img/贊助資訊/自訂稱號.png)

# 累積贊助 5000 新台幣以上回饋 - 建立自定義專屬個人稱號／製作專屬遊戲人偶（擇一）
為感謝玩家們的贊助支持，倘若當您的累積贊助額度達到 <font color="#ffbb06">5000</font> 新台幣，
玩家可至 [Discord 群組 💼・問題求助](https://discord.brilliantw.net/) 申請 1 個 <font color="#a4ff88">【自定義專屬個人稱號】</font>，
或者申請 1 個 <font color="#ff7a7a">【製作專屬遊戲人偶】</font>，二者擇一，
<font color="#a4ff88">【自定義專屬個人稱號】</font> 申請辦法同 <font color="#ffbb06">3470 新台幣以上回饋</font> 所述，

<details>
  <summary>以下為 <font color="#ff7a7a">【製作專屬遊戲人偶】</font> 申請辦法</summary>

請【務必】給予我們您的 <span class="label label-info">SKIN 檔案（.png）</span>，
此外，您還可以自定義玩偶的【名字】與【物品描述】，

隨後，這個玩偶將被加入【輝煌伺服器材質包當中】，
並放置於第一、二、四分流 <span class="label label-info">/spawn</span> 的【贊助感謝牆】上，
最後管理員將給你 1 個 <font color="#ff7a7a">【屬於自己的專屬遊戲人偶】</font>（擇一分流）！
</details>

倘若後續再度累積了 <font color="#ffbb06">5000</font> 新台幣，
可再次獲取【<font color="#a4ff88">建立自定義專屬個人稱號</font>／<font color="#ff7a7a">製作專屬遊戲人偶</font>（擇一）】，
不限次數。

![](img/贊助資訊/專屬遊戲人偶.png)


<script defer>
// [訊] 求您別看這邊的源代碼, 拜託了 >_<
var checkMinecraftNameWithProxy = () => {};
var checkDiscordTagWithProxy = () => {};
var checkAmount = () => {};
var formSubmit = () => false;
var clickboxVerify = () => {};

let minecraftAccountStatus = false;
let discordAccountStatus = false;

window.onload = function() {
  calculateWatercress = () => {
    let amount = $('#donate-amount').val();
    let cumulativeAmount = $('#cumulative-amount').val();
    let watercress = 0;

    const bonuses = [170, 470, 970, 1170, 1970, 2470, 2970, 3470, 3970];
    const increments = [200, 580, 1210, 1590, 2620, 2820, 3270, 3870, 4470];

    if (amount.length > 0) {
      let amountInNum = Number(amount);
      let cumulativeInNum = Number(cumulativeAmount) || 0;
      let totalAmount = amountInNum + cumulativeInNum;

      if (!isNaN(amountInNum) && amountInNum >= 30 && amountInNum <= 10000) {
        watercress = amountInNum;
        for (let i = 0; i < bonuses.length; i++) {
          if (totalAmount >= bonuses[i] && cumulativeInNum < bonuses[i]) {
            watercress += increments[i];
          }
        }
        $('#Watercress-output').text(`獲取水芥：${watercress} 個`).css('color', '#e6bbf6');
        $('#donate-amount').removeClass('border-danger').addClass('border-success');
        $('#preserve-amount').text('').css('color', 'green');
      } else {
        $('#Watercress-output').text('');
        $('#donate-amount').removeClass('border-success').addClass('border-danger');
        $('#preserve-amount').text('').css('color', 'red');
      }
    } else {
      $('#Watercress-output').text('');
      $('#donate-amount').removeClass('border-success border-danger');
      $('#preserve-amount').text('').removeAttr('style');
    }

    let cumulativeInNum = Number(cumulativeAmount) || 0;
    let nextBonus = bonuses.find(bonus => bonus > cumulativeInNum) || bonuses[bonuses.length - 1];
    let amountNeeded = nextBonus - cumulativeInNum;

    if (cumulativeInNum >= bonuses[bonuses.length - 1]) {
      $('#cumulative-amount-output').text('您已達到最高贊助階級，感謝您！').css('color', '#e6bbf6');
    } else if (!isNaN(cumulativeInNum) && cumulativeInNum >= 0) {
      $('#cumulative-amount-output').text(`距離下一階級，還需贊助 ${amountNeeded} 元`).css('color', '#e6bbf6');
    } else {
      $('#cumulative-amount-output').text('').removeAttr('style');
    }
  };

  checkMinecraftNameWithProxy = () => {
    let name = $('#minecraftName').val();
    if (name.length > 2 && name.length < 23) {
      // 步驟 1: 從 minecraftservices 獲取 UUID
      fetch(`https://api.minecraftservices.com/minecraft/profile/lookup/name/${encodeURIComponent(name)}`, {
        headers: { 'Content-Type': 'application/json' }
      })
        .then(res => {
          if (res.status === 404) {
            $('#preserve-minecraft-name').text('找不到此 Minecraft ID，請確認 ID 是否正確。');
            $('#minecraftName').removeClass('border-success').addClass('border-danger');
            $('#preserve-minecraft-name').attr('style', 'color: red');
            minecraftAccountStatus = false;
            $('#cumulative-amount').val(''); // 清空累積贊助金額
            $('#cumulative-amount-output').text('').removeAttr('style');
            console.error('UUID 查詢失敗: 玩家名稱不存在 (404)');
            return Promise.reject('Player not found');
          }
          if (!res.ok) {
            const errorMsg = `UUID 查詢失敗，狀態碼: ${res.status}`;
            $('#preserve-minecraft-name').text(errorMsg);
            $('#minecraftName').removeClass('border-success').addClass('border-danger');
            $('#preserve-minecraft-name').attr('style', 'color: red');
            minecraftAccountStatus = false;
            $('#cumulative-amount').val('');
            $('#cumulative-amount-output').text('').removeAttr('style');
            console.error(errorMsg);
            return Promise.reject(errorMsg);
          }
          return res.json();
        })
        .then(data => {
          const targetUUID = data.id.replace(/^(.{8})(.{4})(.{4})(.{4})(.{12})$/, '$1-$2-$3-$4-$5');
          
          // 步驟 2: 檢查 Minecraft ID 是否存在於伺服器
          return fetch('https://api.brilliantw.net/api/v1/proxy', {
            method: 'POST',
            headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
            body: 'name=' + encodeURIComponent(name)
          })
            .then(res => {
              if (!res.ok) {
                const errorMsg = `伺服器檢查失敗，狀態碼: ${res.status}`;
                $('#preserve-minecraft-name').text(errorMsg);
                $('#minecraftName').removeClass('border-success').addClass('border-danger');
                $('#preserve-minecraft-name').attr('style', 'color: red');
                minecraftAccountStatus = false;
                $('#cumulative-amount').val('');
                $('#cumulative-amount-output').text('').removeAttr('style');
                console.error(errorMsg);
                return Promise.reject(errorMsg);
              }
              return res.json();
            })
            .then(serverData => {
              if (serverData.data?.userExists) {
                $('#preserve-minecraft-name').text('此「遊戲ID」存在，請放心填寫其他欄位。');
                $('#minecraftName').removeClass('border-danger').addClass('border-success');
                $('#preserve-minecraft-name').attr('style', 'color: green');
                minecraftAccountStatus = true;

                // 步驟 3: 查詢贊助金額
                return fetch(`https://donation-api.brilliantw.net/api/Donation/QueryUserDonation?uuid=${targetUUID}`, {
                  headers: { 'Content-Type': 'application/json' }
                })
                  .then(res => {
                    if (!res.ok) {
                      const errorMsg = `贊助金額查詢失敗，狀態碼: ${res.status}`;
                      $('#preserve-minecraft-name').text(errorMsg);
                      $('#minecraftName').removeClass('border-success').addClass('border-danger');
                      $('#preserve-minecraft-name').attr('style', 'color: red');
                      minecraftAccountStatus = false;
                      $('#cumulative-amount').val('');
                      $('#cumulative-amount-output').text('').removeAttr('style');
                      console.error(errorMsg);
                      return Promise.reject(errorMsg);
                    }
                    return res.json();
                  })
                  .then(donationData => {
                    if (donationData.success && donationData.donationInfo) {
                      const totalDonationPaidAmount = donationData.donationInfo.totalDonationPaidAmount || 0;
                      $('#cumulative-amount').val(totalDonationPaidAmount); // 自動填入累積贊助金額
                      calculateWatercress(); // 觸發計算水芥和下一階級提示
                      console.log(`成功查詢贊助金額: ${totalDonationPaidAmount} 新台幣`);
                    } else {
                      $('#cumulative-amount').val('0'); // 無贊助紀錄時填入 0
                      calculateWatercress();
                      console.log('無贊助紀錄，設置累積金額為 0');
                    }
                  });
              } else {
                $('#preserve-minecraft-name').text('你似乎沒有進入過輝煌伺服器，請加入過至少一次再填寫此欄位，也有可能是你「遊戲ID」寫錯了。');
                $('#minecraftName').removeClass('border-success').addClass('border-danger');
                $('#preserve-minecraft-name').attr('style', 'color: red');
                minecraftAccountStatus = false;
                $('#cumulative-amount').val('');
                $('#cumulative-amount-output').text('').removeAttr('style');
                console.log('伺服器檢查失敗: 玩家未加入輝煌伺服器');
              }
            });
        })
        .catch(error => {
          const errorMsg = error === 'Player not found' ? '玩家名稱不存在' : `查詢失敗: ${error}`;
          $('#preserve-minecraft-name').text(`查詢失敗: ${errorMsg}`);
          $('#minecraftName').removeClass('border-success').addClass('border-danger');
          $('#preserve-minecraft-name').attr('style', 'color: red');
          minecraftAccountStatus = false;
          $('#cumulative-amount').val('');
          $('#cumulative-amount-output').text('').removeAttr('style');
          console.error('查詢錯誤:', error);
        });
    } else if (name.length === 0) {
      $('#preserve-minecraft-name').text('');
      $('#minecraftName').removeClass('border-success border-danger');
      $('#preserve-minecraft-name').removeAttr('style');
      minecraftAccountStatus = false;
      $('#cumulative-amount').val('');
      $('#cumulative-amount-output').text('').removeAttr('style');
      console.log('Minecraft ID 欄位為空，清空相關欄位');
    }
  };

  checkDiscordTagWithProxy = () => {
    let name = $('#discordTag').val();
    let nameWithHash = name.includes('#') ? name : name + '#0';
    if (name.length > 1 && name.length < 41) {
      fetch('https://api.brilliantw.net/api/v1/proxy', { 
        method: 'POST', 
        headers: { 
          'Content-Type': 'application/x-www-form-urlencoded'
        },
        body: 'discordTag=' + encodeURIComponent(nameWithHash)
      })
      .then(res => res.json())
      .then(data => {
        if (data.data?.userExists) {
          $('#preserve-discord-tag').text('此「Discord 使用者名稱」存在，請放心填寫其他欄位。');
          if ($('#discordTag').hasClass('border-danger')) $('#discordTag').removeClass('border-danger');
          if ($('#discordTag').hasClass('border-success')) return;
          $('#discordTag').addClass('border-success');
          $('#preserve-discord-tag').attr('style', 'color: green');
          discordAccountStatus = true;
        } else {
          $('#preserve-discord-tag').text('你似乎沒有進入過輝煌 Discord 群組，請加入後再填寫此欄位，也有可能是你「Discord 使用者名稱」寫錯了。');
          if ($('#discordTag').hasClass('border-success')) $('#discordTag').removeClass('border-success');
          if ($('#discordTag').hasClass('border-danger')) return;
          $('#discordTag').addClass('border-danger');
          $('#preserve-discord-tag').attr('style', 'color: red');
          discordAccountStatus = false;
        }
      })
      .catch(() => {});
    } else if (name.length === 0) {
      if ($('#preserve-discord-tag').text().length) $('#preserve-discord-tag').text('');
      if ($('#discordTag').hasClass('border-success')) $('#discordTag').removeClass('border-success');
      if ($('#discordTag').hasClass('border-danger')) $('#discordTag').removeClass('border-danger');
      if ($('#preserve-discord-tag').attr('style')) $('#preserve-discord-tag').removeAttr('style');
      discordAccountStatus = false;
    }
  }
  
  checkAmount = () => {
    let amount = $('#donate-amount').val();
    if (amount.length > 0) {
      let amountInNum = Number(amount);
      if (amountInNum >= 30 && amountInNum <= 10000) {
        $('#preserve-amount').text('此「金額」的範圍在 30 ~ 10000 之間，請放心填寫其他欄位。');
        if ($('#donate-amount').hasClass('border-danger')) $('#donate-amount').removeClass('border-danger');
        if ($('#donate-amount').hasClass('border-success')) return;
        $('#donate-amount').addClass('border-success');
        $('#preserve-amount').attr('style', 'color: green');
      } else {
        $('#preserve-amount').text('此「金額」的範圍不在 30 ~ 10000 之間，請確認填寫金額是否過少或過多。');
        if ($('#donate-amount').hasClass('border-success')) $('#donate-amount').removeClass('border-success');
        if ($('#donate-amount').hasClass('border-danger')) return;
        $('#donate-amount').addClass('border-danger');
        $('#preserve-amount').attr('style', 'color: red');
      }
    } else {
      if ($('#preserve-amount').text().length) $('#preserve-amount').text('');
      if ($('#donate-amount').hasClass('border-success')) $('#donate-amount').removeClass('border-success');
      if ($('#donate-amount').hasClass('border-danger')) $('#donate-amount').removeClass('border-danger');
      if ($('#preserve-amount').attr('style')) $('#preserve-amount').removeAttr('style');
    }
  }

  formSubmit = () => {
    const loading = document.createElement('div');
    loading.id = 'loading';
    loading.style.position = 'fixed';
    loading.style.top = '0';
    loading.style.left = '0';
    loading.style.width = '100%';
    loading.style.height = '100%';
    loading.style.backgroundColor = 'rgba(0,0,0,0.5)';
    loading.style.display = 'flex';
    loading.style.justifyContent = 'center';
    loading.style.alignItems = 'center';
    loading.style.zIndex = '1000';
    loading.innerHTML = `
      <div style="text-align: center; color: white;">
        <div style="width: 40px; height: 40px; border: 4px solid #f3f3f3; border-top: 4px solid #007bff; border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto;"></div>
        <p>正在處理，請稍候...</p>
      </div>
      <style>
        @keyframes spin {
          0% { transform: rotate(0deg); }
          100% { transform: rotate(360deg); }
        }
      </style>
    `;
    document.body.appendChild(loading);

    if (!document.getElementById("check-tos").checked) {
      $('#preserve-checkbox-status').text('倘若想要進行贊助，您必須同意服務條款之規定。');
      document.body.removeChild(loading);
      return false;
    }

    if (!minecraftAccountStatus || !$('#minecraftName').val().length) {
      alert('請填寫有效的 Minecraft ID。');
      document.body.removeChild(loading);
      return false;
    }

    if (!discordAccountStatus || !$('#discordTag').val().length) {
      alert('您必須要填寫有效的 Discord Tag。');
      document.body.removeChild(loading);
      return false;
    }

    if ($('#comment').val().length > 0 && $('#comment').val().includes('@')) {
      alert('贊助訊息不得含有 「@」 符號。');
      document.body.removeChild(loading);
      return false;
    }

    let discordTag = $('#discordTag').val();
    let discordTagWithHash = discordTag.includes('#') ? discordTag : discordTag + '#0';

    let formData = $('form').serializeArray();
    formData = formData.map(item => {
      if (item.name === 'discordTag') {
        return { name: 'discordTag', value: discordTagWithHash };
      }
      return item;
    });

    fetch('https://api.brilliantw.net/api/v1/proxy', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/x-www-form-urlencoded'
      },
      body: $.param(formData)
    })
    .then(res => res.json())
    .then(data => {
      document.body.removeChild(loading);

      if (data.status) {
        const messageLines = data.message.split('\n').map(line => `<p>${line}</p>`).join('');
        const barcodeImageHtml = data.barcodeImage ? `<img src="${data.barcodeImage}" alt="條碼圖片" style="max-width: 100%; margin-top: 20px;">` : '';

        const paymentPage = `
          <!DOCTYPE html>
          <html>
          <head>
            <title>輝煌伺服器 - 訂單資訊</title>
            <meta charset="UTF-8">
            <meta name="viewport" content="width=device-width, initial-scale=1.0">
            <style>
              body { 
                font-family: 'Noto Sans CJK', sans-serif; 
                margin: 20px; 
                line-height: 1.6;
                background-color: #f4f4f4;
              }
              .container { 
                max-width: 600px; 
                margin: 0 auto; 
                padding: 20px;
                border: 1px solid #ddd;
                border-radius: 5px;
                background-color: #fff;
                box-shadow: 0 2px 5px rgba(0,0,0,0.1);
              }
              h2 {
                color: #333;
                margin-bottom: 20px;
                text-align: center;
              }
              p {
                margin: 10px 0;
                word-wrap: break-word;
              }
              .back-button {
                display: inline-block;
                margin-top: 20px;
                padding: 10px 20px;
                background-color: #007bff;
                color: #fff;
                text-decoration: none;
                border-radius: 5px;
                text-align: center;
                border: none;
                cursor: pointer;
              }
              .back-button:hover {
                background-color: #0056b3;
              }
              @media (max-width: 600px) {
                .container {
                  margin: 10px;
                  padding: 15px;
                }
              }
            </style>
          </head>
          <body>
            <div class="container">
              <h2>輝煌 Brilliant Minecraft Server</h2>
              <p>訂單資訊生成成功！以下是您的訂單資訊：</p>
              ${messageLines}
              ${barcodeImageHtml}
              <p>如有任何問題，請聯繫 <a href="mailto:ricechen@brilliantw.net">ricechen@brilliantw.net</a></p>
              <button class="back-button" onclick="history.back()">返回上一頁</button>
            </div>
          </body>
          </html>
        `;

        // 創建 Blob 並生成臨時 URL，然後重定向
        const paymentBlob = new Blob([paymentPage], { type: 'text/html' });
        const paymentUrl = URL.createObjectURL(paymentBlob);
        window.location.href = paymentUrl;
      } else {
        alert(`請至輝煌伺服器 Discord 群組回報錯誤代碼 ${data.message}，倘若造成您的不便敬請見諒。`);
      }
    })
    .catch(error => {
      document.body.removeChild(loading);
      console.error('Fetch error:', error);
      alert('發生錯誤，請檢查網路連線，或者稍等 5 至 10 分鐘後重試操作，倘若造成您的不便敬請見諒。');
    });
    return false;
  };

  clickboxVerify = () => {
    if (document.getElementById("check-tos").checked) $('#preserve-checkbox-status').text('');
  }
  
  document.getElementById("submit").addEventListener("click", formSubmit, false);
  document.getElementById("check-tos").addEventListener("click", clickboxVerify, false);
}
</script>
